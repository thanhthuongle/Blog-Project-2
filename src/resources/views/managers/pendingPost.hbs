<div class="container mt-4 border rounded" style="background-color: white;">
    <div class="text-center mt-4 mb-5">
        <h2>TRANG QUẢN LÝ</h2>
        <hr class="mt-1" style="border-top: 2px solid rgba(0, 0, 0, .1); width: 30%;">
    </div>
    <div class="mt-4 ml-2">
        <a href="#" style="text-decoration: none;">
            <button type="button" class="btn btn-warning mr-2" style="color: white;">Bài đăng chờ duyệt</button>
        </a>
        <a href="/managers/approvedPost" style="text-decoration: none;">
            <button type="button" class="btn btn-success mr-2">Bài đăng đã duyệt</button>
        </a>
        <a href="/managers/rejectedPost" style="text-decoration: none;">
            <button type="button" class="btn btn-danger">Bài đăng đã từ chối</button>
        </a>
    </div>

    <div class="container border rounded m-2">
        <div class="mt-4">
            <h3 class="text-center">{{#managerCheckStatus status}}{{/managerCheckStatus}}</h3>
            <table class="table mt-4 text-center table-striped">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Tên bài đăng</th>
                        <th scope="col" style="min-width: 115px;">Người đăng</th>
                        <th scope="col" style="min-width: 110px;">Trạng thái</th>
                        <th scope="col">Thời gian tạo</th>
                        <th scope="col" colspan="2">Xét duyệt</th>
                    </tr>
                </thead>
                <tbody>
                    {{#if posts}}{{else}} <tr><td colspan="6">Không có bài đăng nào chờ phê duyệt.</td></tr> {{/if}}
                    {{#each posts}}
                    <tr>
                        <th scope="row">{{sum @index 1}}</th>
                        <td>
                            <a href="/posts/{{this._id}}" style="text-decoration: none;">{{this.title}}</a>
                        </td>
                        <td>{{this.userPost.[0].name}}</td>
                        <td style= "color: {{#checkColorStatus this.status}}{{/checkColorStatus}};" >
                            {{#checkStatus this.status}}{{/checkStatus}}
                        </td>
                        <td>{{this.createdAt}}</td>
                        <td>
                             <a href="" class="btn btn-success" data-id="{{this._id}}" data-toggle="modal" data-target="#aprrove-post-modal">Duyệt</a>
                        </td>
                        <td>
                            <a href="" class="btn btn-danger" data-id="{{this._id}}" data-toggle="modal" data-target="#reject-post-modal">Từ Chối</a>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>

            <form method="POST" name="review-post-form"></form>

            <div id="aprrove-post-modal" class="modal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Duyệt bài đăng?</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>Bạn chắc chắn muốn duyệt bài đăng này?</p>
                        </div>
                        <div class="modal-footer">
                            <button id="btn-manager-approve" type="button" class="btn btn-success ">Duyệt</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="reject-post-modal" class="modal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Từ chối bài đăng?</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>Bạn chắc chắn muốn từ chối bài đăng này?</p>
                        </div>
                        <div class="modal-footer">
                            <button id="btn-manager-reject" type="button" class="btn btn-danger ">Từ chối</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    var managerID = "{{user._id}}";
                    var postID;
                    var reviewForm = document.forms['review-post-form'];

                    $('#aprrove-post-modal').on('show.bs.modal', function (event) {
                        var button = $(event.relatedTarget);
                        postID = button.data('id');
                    })
                    let btnManagerApprove = document.getElementById('btn-manager-approve');
                    btnManagerApprove.onclick = function () {
                        reviewForm.action = '/managers/' + managerID + '/approve/' + postID +'?_method=PUT';
                        reviewForm.submit();
                    }

                    $('#reject-post-modal').on('show.bs.modal', function (event) {
                        var button = $(event.relatedTarget);
                        postID = button.data('id');
                    })
                    let btnManagerReject = document.getElementById('btn-manager-reject');
                    btnManagerReject.onclick = function () {
                        reviewForm.action = '/managers/' + managerID + '/reject/' + postID +'?_method=PUT';
                        reviewForm.submit();
                    }
                    
                });
            </script>

        </div>
    </div>
</div>