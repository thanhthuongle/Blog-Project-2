<style>
    #btn-submit-comment:hover{
        background-color:#E4E6EB;
    }
    #btn-submit-comment:hover{
        background-color: #007BFF;
        color: white;
    }
</style>

<div class="container border rounded mt-4 mb-5" style="background-color: white;">

    {{!-- group show post detail! --}}
    <div class="border-bottom">
        <h1 class="text-center mt-4 mb-4">{{post.title}}</h1>
        <h6>
                <span>
                    Author:&nbsp;{{user.name}}
                </span>
                
                <span class="ml-2">
                    | &nbsp;Date:
                    {{formatDateTime post.createdAt}}
                </span>
        </h6>
        <br>
        <div class="text-center" >
            <img style="width: 100%; height: auto; max-height: 450px;" src="{{post.thumbnail}}" alt="">
        </div>
        <div class="mt-4 text-wrap" >
            <div style="white-space: pre-line;">
                {{#if post.contentHtml}}
                    {{{post.contentHtml}}}
                {{else}}
                    {{post.content}}
                {{/if}}
                
            </div>
        </div>
    </div>

{{!-- group like, share, comment button--}}
    <div class="text-center mt-4" style="margin-bottom: 1rem; background-color: white;">
        <div class="row ">
            <div class="col-4">Like:&nbsp; <span>{{post.like}}</span> </div>
            <div class="col-4">Comment:&nbsp; <span>{{post.comment}}</div>
            <div class="col-4">{{!--Share:&nbsp;--}} <span>{{!--{{post.share}}--}} Chia sẻ ngay</div>
        </div>

        <hr>

        <div class="row mt-1">
            <div class="col-4">
                <button type="button"  id="btn-update-like" class="btn btn-light" style="width: 70%;" data-userID="{{user._id}}" data-postID="{{post._id}}" >
                    <img src={{#if likeStatus}}"/image/likedIcon.png"{{else}}"/image/likeIcon.png"{{/if}} alt="" style="width:20px; height:auto;">
                    <span class="align-middle">Thích</span>   
                </button>
            </div>

            <form method="POST" id="updateLike"></form>
            <script>
                document.getElementById('btn-update-like').addEventListener('click', function() {
                    let userID = this.getAttribute('data-userID');
                    let postID = this.getAttribute('data-postID');
                    let form = document.getElementById('updateLike');
                    form.action = '/likes/' + postID + '/' + userID + '?_method=PUT';
                    form.submit();
                });
            </script>


            <div class="col-4">
                <a href="#comment">
                    <button type="button" class="btn btn-light" style="width: 70%;">
                        <img src="/image/commentIcon.png" alt="" style="width:20px; height:auto;">
                        <span class="align-middle">Bình luận</span>   
                    </button>
                </a>
            </div>
            <div class="col-4">
                <button type="button" class="btn btn-light" style="width: 70%; ">
                    <img src="/image/shareIcon.png" alt="" style="width:20px; height:auto;">
                    <span class="align-middle">Chia sẻ</span>   
                </button>
            </div>
        </div>

        <hr>
    </div>

{{!-- group user view comment --}}
    <div>
        <b>
            <a href="" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Xem thêm bình luận</a>
        </b>
        {{#each comments}}
        <div class="mb-4">
            <div class="border rounded mt-3" style="width: 100%; background-color: #E4E6EB;">
                <div class="mt-2 ml-2 mr-2">
                    <img src="{{this.userComment.[0].avatar}}" alt="" class="rounded-circle " style="width: 30px; height: 30px; ">
                    <b class="align-middle">{{this.userComment.[0].name}}</b>
                </div>
                <p class="pt-3 pl-2 pr-2 pb-1">
                    {{this.contentComment}}
                </p>
            </div>
        </div> 
        {{/each}} 
    </div>

{{!-- group user write comment! --}}
    <div class="mt-5 mb-5">
        <form method="POST" action="/comments/{{post._id}}/{{user._id}}">
            <div class="form-group clearfix" >
                <div class="float-left " style="width: 6%;">
                    <img src="{{user.avatar}}" class="rounded-circle" alt="" style="width: 50px; height: 50px;">
                </div>
                <div class="float-left" style="width: 94%;"> 
                    <input type="hidden" name="userID" value="{{user._id}}">
                    <input type="hidden" name="postID" value="{{post._id}}">
                    <textarea class="form-control" id="comment" rows="3" name="contentComment" style="background-color: #E4E6EB;" placeholder="Viết bình luận..." required></textarea>
                    <button type="button" class="btn btn-secondary mr-4" style="margin-top: 0.8rem;" onclick="clearComment()" >
                        Hủy
                    </button>
                    <button type="submit" id="btn-submit-comment" class="btn btn-light mr-4" style="margin-top: 0.8rem; ">
                        Bình luận
                        <img src="/image/sendIcon.png" alt="" style="width: 20px; height: 20px; margin-left: 5px;" class="text-center align-middle mx-auto">     
                    </button>
                </div>
            </div>
        </form>

        <script>
            function clearComment() {
                document.getElementById('comment').value = '';
            }
        </script>
    </div>
</div>

<script>
    // Lưu vị trí cuộn trước khi reload
    window.addEventListener('beforeunload', function() {
        localStorage.setItem('scrollPosition', window.scrollY);
    });

    // Gán lại vị trí cuộn sau khi trang được tải lại
    window.addEventListener('load', function() {
        var savedScrollPosition = localStorage.getItem('scrollPosition');
        if (savedScrollPosition) {
            window.scrollTo(0, savedScrollPosition);
            localStorage.removeItem('scrollPosition'); // Xóa vị trí đã lưu sau khi sử dụng
        }
    });
</script>



